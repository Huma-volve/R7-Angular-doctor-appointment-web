<div class="container py-4 mt-5 d-flex justify-content-center align-items-center">
  <div class="container-content">
    <!-- Header -->
    <div class="d-flex align-items-center mb-3">
      <a (click)="backToPaymentMethod()" class="text-dark me-3"><i class="fa-solid fa-arrow-left"></i></a>
      <h5 class="mb-0">Add New Card</h5>
    </div>

    <!-- Card Preview -->
    <div class="card-container">
      <div class="card rounded-5" [class.flipped]="cvvFocus">
        <!-- Front Side -->
        <div class="card-side card-front">
          <div class="d-flex justify-content-between align-items-center">
            <span class="fw-semibold text-capitalize">{{selectedPaymentMethod}}</span>
            @if (selectedPaymentMethod == 'paypal') {
              <i class="fa-brands fa-cc-paypal fa-2x"></i>
            }@else if (selectedPaymentMethod == 'mastercard') {
              <i class="fa-brands fa-cc-mastercard fa-2x"></i>
            }@else if (selectedPaymentMethod == 'visa') {
              <i class="fa-brands fa-cc-visa fa-2x"></i>
            }@else{
              <i class="fa-brands fa-2x">
                <img src="./assets/images/apple-pay.png" alt="Apple Pay Logo">
              </i>
            }
          </div>
          <div class="card-number mt-3  fs-5">{{ number | cardNumber }}</div>
          <div class="d-flex mt-4 justify-content-between align-items-center mt-2">
            <small>{{ name || 'Cardholder Name' }}</small>
            <small>{{ expiryMonth || 'MM' }}/{{ expiryYear || 'YY' }}</small>
          </div>
        </div>

        <!-- Back Side -->
        <div class="card-side card-back">
          <div class="magnetic-strip"></div>
          <div class="cvv-box"><span>{{ cvv || '000' }}</span></div>
        </div>
      </div>
    </div>

    <!-- Form -->
    <form #cardForm="ngForm" (ngSubmit)="onSubmit(cardForm)" class="mt-4">
      <!-- Cardholder Name -->
      <div class="mb-3">
        <label class="form-label">Cardholder Name</label>
        <input
          type="text"
          class="form-control"
          placeholder="Cardholder Name"
          [(ngModel)]="name"
          name="name"
          required
        />
      </div>

      <!-- Card Number -->
      <div class="mb-3">
        <label class="form-label">Card Number</label>
        <div class="input-group">
          <input
            [type]="showNumber ? 'text' : 'password'"
            class="form-control"
            placeholder="Card Number"
            maxlength="19"
            [(ngModel)]="number"
            name="number"
            required
            (input)="onlyNumbers($event)"
          />
          <span class="input-group-text bg-white" (click)="toggleNumber()" style="cursor: pointer;">
            <i class="fa-solid" [ngClass]="showNumber ? 'fa-eye-slash' : 'fa-eye'"></i>
          </span>
        </div>
      </div>

      <!-- Expiry Date & CVV -->
      <div class="row">
        <div class="col-6 mb-3">
          <label class="form-label">Expiry Date</label>
          <div class="d-flex">
            <input
              type="text"
              class="form-control me-2"
              placeholder="MM"
              maxlength="2"
              min="1"
              max="12"
              [(ngModel)]="expiryMonth"
              name="expiryMonth"
              required
              (input)="validateMonth()"
            />
            <input
              type="text"
              class="form-control"
              placeholder="YY"
              maxlength="4"
              min="2000"
              max="9999"
              [(ngModel)]="expiryYear"
              name="expiryYear"
              required
              (input)="validateYear()"
            />
          </div>
        </div>

        <div class="col-6 mb-3">
          <label class="form-label">CVV Code</label>
          <input
            type="text"
            class="form-control"
            placeholder="000"
            maxlength="3"
            [(ngModel)]="cvv"
            name="cvv"
            required
            (focus)="onCvvFocus()"
            (blur)="onCvvBlur()"
            (input)="onlyNumbers($event)"
          />
        </div>
      </div>
      @if(!isValid()){
        <p class="text-danger py-2">
          Please fill all required fields.
        </p>
      }
      <button type="submit" class="save-btn mt-2 btn btn-primary w-100">Save</button>
    </form>
  </div>
</div>
